# 轮播图和热门数据等级配置指南

## 功能说明

本次更新为后台基础设置添加了两个新的配置项：

- **轮播图推荐等级**：控制首页轮播图显示哪个等级的视频内容
- **热门数据等级**：控制热门数据模块显示哪个等级的视频内容

## 安装步骤

### 1. 数据库更新

请执行以下 SQL 语句来更新数据库结构：

```sql
-- 为 mac_ovo_setting 表添加新字段
ALTER TABLE `mac_ovo_setting`
ADD COLUMN `banner_level` int(11) NOT NULL DEFAULT 9 COMMENT '轮播图推荐等级(1-9)' AFTER `encrypt_key`;

ALTER TABLE `mac_ovo_setting`
ADD COLUMN `hot_level` int(11) NOT NULL DEFAULT 6 COMMENT '热门数据等级(1-9)' AFTER `banner_level`;

-- 为已存在的记录设置默认值
UPDATE `mac_ovo_setting` SET
    `banner_level` = 9,
    `hot_level` = 6
WHERE `banner_level` IS NULL OR `hot_level` IS NULL;
```

### 2. 文件更新

确保以下文件已正确更新：

- `houduan/setting.php` - 后台设置页面
- `houduan/api/controllers/BannerController.php` - 轮播图控制器
- `houduan/api/controllers/HotvedioController.php` - 热门数据控制器

## 使用方法

### 1. 后台配置

1. 登录后台管理系统
2. 进入"系统设置" -> "基础设置"
3. 在表单底部找到新增的两个配置项：
   - **轮播图推荐等级**：选择 1-9 的等级值（默认：9）
   - **热门数据等级**：选择 1-9 的等级值（默认：6）
4. 点击"保存设置"

### 2. 等级说明

- **等级范围**：1-9，数字越大代表优先级越高
- **轮播图推荐等级**：控制首页轮播图显示的视频等级
- **热门数据等级**：控制热门数据接口返回的视频等级

### 3. API 行为

#### 轮播图 API (`/api/v1/banners`)

- 自动读取后台配置的轮播图推荐等级
- 只返回对应等级且有轮播图片的视频

#### 热门数据 API (`/api/v1/hotvedios`)

- 默认使用后台配置的热门数据等级
- 仍支持通过 `level` 参数覆盖默认值
- 例如：`/api/v1/hotvedios?level=8` 仍然可以指定特定等级

## 技术细节

### 数据库结构

```sql
ALTER TABLE `mac_ovo_setting` ADD COLUMN `banner_level` int(11) NOT NULL DEFAULT 9;
ALTER TABLE `mac_ovo_setting` ADD COLUMN `hot_level` int(11) NOT NULL DEFAULT 6;
```

### 向后兼容性

- 如果数据库中没有配置或配置为空，系统会使用默认值
- 轮播图默认等级：9
- 热门数据默认等级：6
- 热门数据 API 仍支持通过参数指定等级

### 错误处理

- 数据库查询失败时使用默认值
- 无效配置值时使用默认值
- 保证系统稳定运行

## 常见问题

### Q: 修改配置后没有立即生效？

A: 确保：

1. 数据库已正确执行 SQL 更新语句
2. 后台设置已保存成功
3. 清除可能的缓存

### Q: 如何验证配置是否生效？

A: 可以通过以下方式验证：

1. 检查轮播图 API 返回的数据是否符合配置的等级
2. 检查热门数据 API 的默认行为是否使用了配置的等级

### Q: 是否影响现有功能？

A: 完全向后兼容，不会影响现有功能：

- 轮播图仍然正常显示，只是等级可配置
- 热门数据 API 保持原有的参数支持

## 更新日志

- ✅ 添加轮播图推荐等级配置
- ✅ 添加热门数据等级配置
- ✅ 更新后台设置界面
- ✅ 修改相关 API 控制器
- ✅ 保持向后兼容性

