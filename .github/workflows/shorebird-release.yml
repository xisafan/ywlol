name: ğŸš€ Shorebird Hot Update Release

on:
  workflow_dispatch:
    inputs:
      update_message:
        description: "æ›´æ–°è¯´æ˜"
        required: true
        default: "ä¿®å¤bugå’Œæ€§èƒ½ä¼˜åŒ–"

jobs:
  shorebird-release:
    name: ğŸ“± å‘å¸ƒçƒ­æ›´æ–°
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"
          cache: true

      - name: ğŸ“± Install Shorebird
        run: |
          curl --proto '=https' --tlsv1.2 https://raw.githubusercontent.com/shorebirdtech/install/main/install.sh -sSf | bash
          echo "$HOME/.shorebird/bin" >> $GITHUB_PATH

      - name: ğŸ”‘ Setup Shorebird Token
        env:
          SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}
        run: |
          echo "Token configured for Shorebird"
          shorebird doctor

      - name: ğŸ“¦ Get dependencies
        run: flutter pub get

      - name: ğŸš€ Release hot update (Android)
        env:
          SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}
        run: |
          shorebird release android --flutter-version=$(flutter --version --machine | jq -r '.flutterVersion')

      - name: ğŸ Release hot update (iOS)
        env:
          SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}
        run: |
          shorebird release ios --flutter-version=$(flutter --version --machine | jq -r '.flutterVersion')

      - name: ğŸ“ Create patch (ç¤ºä¾‹)
        env:
          SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}
        run: |
          echo "å¯ä»¥åœ¨è¿™é‡Œåˆ›å»ºçƒ­æ›´æ–°è¡¥ä¸"
          echo "shorebird patch android --release-version=1.0.0+1"
          echo "shorebird patch ios --release-version=1.0.0+1"
